#!/bin/bash

set -e

# //////////////////////////////////////////////////////////////////////////////
# Variables
# //////////////////////////////////////////////////////////////////////////////
KIT_PATH="$PWD"
KIT_API_PATH="$KIT_PATH/kit_api"
KIT_DASHBOARD_PATH="$KIT_PATH/kit_dashboard"

# //////////////////////////////////////////////////////////////////////////////
# Common Functions
# //////////////////////////////////////////////////////////////////////////////
function confirm_command () {
  read -p "Are you sure? [y/n] " -n 1 -r
  echo  # move to a new line
  if [[ $REPLY =~ ^[Yy]$ ]]
  then
    echo "Running"
  else
    echo "Aborting"
    return 1
  fi
}

# //////////////////////////////////////////////////////////////////////////////
# Setup Functions
# //////////////////////////////////////////////////////////////////////////////
function initialize_git_repos () {
  # Setup directories for api & dashboard
  # Make sure git is installed
  # Change into both and initialize git
  # Pull master on both repos
}

# //////////////////////////////////////////////////////////////////////////////
# Database Functions
# //////////////////////////////////////////////////////////////////////////////
function clear_database () {
  # Wipe db volumes and containers
  # Rebuild via docker-compose build
}

function initialize_database () {
  # Do a local migration
}

# //////////////////////////////////////////////////////////////////////////////
# Run
# //////////////////////////////////////////////////////////////////////////////
while [[ $# > 0 ]]
do
case "${1}" in
  --setup-repos)
  confirm_command
  # Todo
  shift
  ;;
  --deploy-dashboard)
  confirm_command
  # Todo
  shift
  ;;
  --deploy-application)
  confirm_command
  # Todo
  shift
  ;;
  *)
  echo "'${1}' is not a valid operation."
  ;;
esac
shift
done
